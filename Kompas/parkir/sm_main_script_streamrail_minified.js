function printLogs(e){sminternalconfig.logs&&console.log(e)}function printErrors(e){sminternalconfig.logs&&console.error(e)}function getShortString(e,t){return e.length>=t&&(e=e.substring(0,t-3),e+="EOS"),e}function smConvertObjectToString(e){for(var t=Object.keys(e),s=0;s<t.length;s++)smMembers.smStringParams=smMembers.smStringParams+t[s]+"="+e[t[s]]+"&"}function smCallURL(e){printLogs("Start sending request: "+e);try{var t=e;t=getShortString(t,sminternalconfig.maxUrlSize);var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r),printLogs("Finished sending request: "+e)}catch(i){printErrors("Error while get smCallURL , url: "+e+", error: "+i)}}function SMreportEvent(e,t,s){var r="";try{0==smMembers.smStringParams.length&&(smMembers.smStringParams=smMainScript.src.slice(smMainScript.src.indexOf("?")+1)+"&")}catch(i){r+=i}try{r="https:"==smMembers.protocol||"http:"==smMembers.protocol?"":smMembers.protocol+" ";var n=smoperational.visibilityState,o="",a="",m="",c="",l=-1,p=(new Date).getTime(),d=0,g=smoperational.lastEvent;try{m=Math.round(((new Date).getTime()-smcounters.lastEventTS)/100)/10;var u=Math.round(((new Date).getTime()-smoperational.startTime)/100)/10;a="s:"+smoperational.loopnumber+" init_ts:"+u+",_w="+smMembers.docWidth+",_h="+smMembers.smdocHeight+",aval_h:"+smMembers.screen_availHeight+",aval_w:"+smMembers.screen_availWidth+",screen_h:"+smMembers.screen_height+",screen_w:"+smMembers.screen_width,smcounters.lastTag&&null==smoperational.adTagId&&(a=a+" No_tag="+encodeURIComponent(smcounters.lastTag)),smoperational.adTagId&&(d=smTagsObjects[smoperational.adTagId].order,c="("+smoperational.adTagId+")",l="COMPLETE"==e?p-smTagsObjects[smoperational.adTagId].imptime:p-smTagsObjects[smoperational.adTagId].starttime,l=Math.min(l,smcounters.latencyLimit)),smcounters.eventsSentLog=smcounters.eventsSentLog+e+c+":"+u+",",o=smcounters.eventsSentLog;var h=o.length;h>250&&(o=o.substring(h-250,h))}catch(i){r=r+"error: "+i+" ",printErrors("Error while msg:"+i)}finally{l>smcounters.latencyLimit&&(l=smcounters.latencyLimit)}if(a=getShortString(a,2*sminternalconfig.maxParamSize),t=getShortString(t,2*sminternalconfig.maxParamSize),r+=encodeURIComponent(t),randomNumber=Math.floor(100*Math.random()),randomNumber<s){var b=smoperational.eventUrl+"?eventType="+e+"&"+smMembers.smStringParams+"samplingPercent="+s+"&randomNumber="+randomNumber+"&breakIndex="+smcounters.breakIndex+"&smTagId="+smoperational.adTagId+"&hftResponseType="+smoperational.hftResponseType+"&tagPriority="+d+"&smserveflash="+smcounters.serveFlash+"&smssl="+smoperational.ssl+"&smlatency="+l+"&clientVersion="+smoperational.clientVersion+"&waterfallString="+smoperational.waterfallStr+"&sessionId="+smoperational.sessionId+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&smwidth="+smSetupJsonObject.width+"&smheight="+smSetupJsonObject.height+"&message="+r+"&previouseventtype="+g+"&smdynamic3="+a+"&smdynamic4="+m+"&smdynamic2="+o+"&smdynamic1="+n;smCallURL(b)}smcounters.lastEventTS=(new Date).getTime(),smoperational.lastEvent=e,printLogs("%c event= "+e+" tagId= "+smoperational.adTagId+" breakIndex= "+smcounters.breakIndex+" order= "+d+" time from start= "+u,"color: #0000FF")}catch(i){printErrors("Error while report event. event="+e+", msg="+t+", sampling="+s+", randomNumber="+randomNumber+", error="+i)}}function getFlashVersion(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(t){return"6,0,0"}}catch(t){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){}}return"0,0,1"}function smConvertStringToObject(e,t){var s=e.split("&"),r=s[0].split("?");s.push(r[1]),s.shift();for(var i=0;i<s.length;i++){var n=s[i].split("=");t[n[0]]=n[1].toString()}}function smGetVisibilityState(){try{var e,t,s;"undefined"!=typeof document.hidden?(e="hidden",s="visibilitychange",t="visibilityState"):"undefined"!=typeof document.mozHidden?(e="mozHidden",s="mozvisibilitychange",t="mozVisibilityState"):"undefined"!=typeof document.msHidden?(e="msHidden",s="msvisibilitychange",t="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(e="webkitHidden",s="webkitvisibilitychange",t="webkitVisibilityState"),smoperational.visibilityState=document[t],document.addEventListener(s,function(){smoperational.visibilityState=document[t]},!1)}catch(r){smoperational.visibilityState="error"}}function smGetSessionSummary(){var e=0,t=0,s=0,r=0,i=0,n="";for(var o in smTagsObjects)return e=+smTagsObjects[o].requests,t=+smTagsObjects[o].impressions,s<smTagsObjects[o].impressions&&(s=smTagsObjects[o].impressions,r=smTagsObjects[o].requests,i=o),n="totalRequests="+e+" totalImpressions="+t+" bestTag="+i+" req="+r+" imps="+i}function smGetTagSummary(e){var t=smTagsObjects[e].requests,s=smTagsObjects[e].impressions,r=smTagsObjects[e].errors,i=smTagsObjects[e].verifys,n=smTagsObjects[e].completes,o="req="+t+" imp="+s+" ver="+i+" com="+n+" err="+r;return n>s&&0==smcounters.sentImpDiscrepancy&&(smcounters.sentImpDiscrepancy++,SMreportEvent("LOGIC_ERROR","More completes then impressions for tag:"+e+" data:"+o,100)),o}function initMembers(){printLogs("Start init  members");try{smMembers.topLocation=getShortString(encodeURIComponent(top.location.href),sminternalconfig.maxParamSize)}catch(e){printErrors("Error while init topLocation. "+e),smMembers.topLocation="undefined"}-1!=smMembers.topLocation.indexOf("printsmlogs")&&(sminternalconfig.logs=!0),smGetVisibilityState();try{smMainScript=document.getElementById("sm_main_script"),smMainScript&&(smMacrosObject={},smConvertStringToObject(smMainScript.src,smMacrosObject)),smoperational.clientVersion=smoperational.clientVersion+smMacrosObject.cv,smMacrosObject.click&&(smoperational.click=decodeURIComponent(smMacrosObject.click),delete smMacrosObject.click),smoperational.eventUrl="https://"+smMacrosObject.server+".selectmedia.asia/sm.evt",smoperational.hftUrl="https://"+smMacrosObject.server+".selectmedia.asia/sm.hft",printLogs("smMacrosObject= "+JSON.stringify(smMacrosObject)),delete smMacrosObject.cv,delete smMacrosObject.server,delete smMacrosObject.cb}catch(e){SMreportEvent("LOGIC_ERROR",e,100)}try{smMacrosObject.declaredurl=getShortString(encodeURIComponent(decodeURIComponent(smMacrosObject.declaredurl)),sminternalconfig.maxParamSize)}catch(e){printErrors("Error while init reportUrl. "+e),smMacrosObject.declaredurl="undefined"}try{smConvertObjectToString(smMacrosObject)}catch(e){SMreportEvent("LOGIC_ERROR",e,100)}try{smMembers.protocol=location.protocol,printLogs(smMembers.protocol),"https:"==smMembers.protocol?smoperational.ssl=1:("file:"==smMembers.protocol||"ftp:"==smMembers.protocol||"javascript:"==smMembers.protocol)&&(smoperational.validSession=!1,smoperational.sessionBreakReason=smMembers.protocol)}catch(e){SMreportEvent("LOGIC_ERROR","error at protocol: "+e,100)}try{smMembers.docReferrer=getShortString(encodeURIComponent(document.referrer),sminternalconfig.maxParamSize)}catch(e){printErrors("Error while init smdocReferrer. "+e),smMembers.docReferrer="undefined"}if(!smMembers.topLocation||-1==smMembers.topLocation.indexOf("."))try{smMembers.topLocation=getShortString(encodeURIComponent(window.location.href),sminternalconfig.maxParamSize)+"%26smLoc%3Dwindow"}catch(e){printErrors("Error while init smdocReferrer from window.location.href"+e)}try{smcounters.flash=getFlashVersion(),getFlashVersion().split(",").shift()<11&&(smcounters.serveFlash=0)}catch(e){SMreportEvent("LOGIC_ERROR","General exception in get flash/chrome function. using default. Error="+e,100),smcounters.flash=0,smcounters.serveFlash=0}try{smMembers.docWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,smMembers.smdocHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}catch(e){printErrors("Error while get width and height. "+e)}try{smMembers.screen_availHeight=screen.availHeight,smMembers.screen_height=screen.height,smMembers.screen_width=screen.width,smMembers.screen_availWidth=screen.availWidth}catch(e){printErrors("Error while get screen width and height. "+e)}}function getHftResponseFromServer(){if(smoperational.validSession){var e=smoperational.hftUrl+"?"+smMembers.smStringParams+"smserveflash="+smcounters.serveFlash+"&smssl="+smoperational.ssl+"&smlistsize="+smcounters.listsize+"&visibility="+smoperational.visibilityState+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&clientVersion="+smoperational.clientVersion+"&randomNumber="+randomNumber;smCallURL(e)}else SMreportEvent("LOGIC_ERROR","invalid session: "+smoperational.sessionBreakReason,100)}function buildStreamRailSetupObject(e){printLogs(JSON.stringify(e));var t=e.width.toString()+"px",s=e.height.toString()+"px";if(document.getElementById("sm_player"))document.getElementById("sm_player").style.width=t,document.getElementById("sm_player").style.height=s;else{var r=document.createElement("div");r.style.width=t,r.style.height=s,r.id="sm_player",document.body.appendChild(r)}smWaterfallArr=[];for(var i=Math.min(e.tagList.length,e.waterfallSize),n=1e3*e.tagTimeout,o=0;i>o;o++)0==e.tagList[o].tagUrl.indexOf("http")&&(smWaterfallArr[o]={url:e.tagList[o].tagUrl,id:e.tagList[o].id.toString(),adCancelTimeout:n},smTagsObjects[e.tagList[o].id]=e.tagList[o],smTagsObjects[e.tagList[o].id].starttime=0,smTagsObjects[e.tagList[o].id].imptime=0,smTagsObjects[e.tagList[o].id].requests=0,smTagsObjects[e.tagList[o].id].errors=0,smTagsObjects[e.tagList[o].id].impressions=0,smTagsObjects[e.tagList[o].id].completes=0,smTagsObjects[e.tagList[o].id].verifys=0);if("STATIC"==e.responseType&&-1==e.video.indexOf(".mp4")){var a=document.createElement("img");a.src=smWaterfallArr[0].url;var m=e.video;document.getElementById("sm_player").appendChild(a),document.getElementById("sm_player").onclick=function(){window.open(m,"_blank"),SMreportEvent("AD_CLICK",m,100)}}else{printLogs(JSON.stringify(smTagsObjects));var c={};1==e.post&&(c={position:"post-roll",server:{tags:smWaterfallArr}}),smSetupJsonObject.ads.schedule=[{position:"pre-roll",server:{tags:smWaterfallArr}},c];var l=3e4;if(e.mid>0){l=1e3*Math.round(60/e.mid);var p=0,d=1e3*e.timeBetweenTags;0==e.pre&&(p=l),smSetupJsonObject.breakingAds={minTimeBeforeAds:p,enabled:!0,maxAdsPerLoop:e.mid,hideContentControls:!1}}smoperational.hftResponseType=e.responseType,smoperational.sessionId=e.sessionId,smoperational.waterfallStr=e.waterfallId,0==smWaterfallArr.length&&(smSetupJsonObject.breakingAds={},smSetupJsonObject.ads={}),0==e.pre&&0==e.mid&&0==e.post&&delete smSetupJsonObject.ads.schedule,0==e.pre&&0==e.mid&&1==e.post&&smSetupJsonObject.ads.schedule.splice(0,1),smSetupJsonObject.minTimeBetweenWaterfalls=l,smSetupJsonObject.minTimeBetweenAds=l,smSetupJsonObject.minTimeBetweenTags=d,smSetupJsonObject.scaleMode="original",smSetupJsonObject.partnerID="bc1a6ff1-c693-4b2b-9b8b-cc9a54c129fd",smSetupJsonObject.uflash={enabled:!0},smoperational.impressionPixel=e.impressionPixel,smoperational.clickPixel=e.clickPixel,smoperational.completePixel=e.completePixel,smoperational.loop=e.loopNumber,smSetupJsonObject.withCredentials=e.credential,smSetupJsonObject.mute=!e.sound,smSetupJsonObject.width=e.width,smSetupJsonObject.height=e.height,smSetupJsonObject.content.url=e.video,smSetupJsonObject.content.title=e.title,smSetupJsonObject.content.linkUrl=smoperational.click+e.landing_page,smSetupJsonObject.content.linkUrl=smSetupJsonObject.content.linkUrl.trim(),printLogs("smSetupJsonObject.content.linkUrl="+smSetupJsonObject.content.linkUrl),smSetupJsonObject.autoplay=e.autostart,smoperational.loop>0?smSetupJsonObject.loop=!0:smSetupJsonObject.loop=!1,smSetupJsonObject.autoResize=!1,smSetupJsonObject.iframe=!1;var g=!1,u=e.logo_landing_page,h=e.logoLink;0==u.indexOf("http")&&(g=!0),0==h.indexOf("http")&&(smSetupJsonObject.watermark={file:h,xpos:0,ypos:0,xrepeat:0,opacity:.7,clickable:g,url:u}),printLogs(JSON.stringify(smTagsObjects)),printLogs(JSON.stringify(smSetupJsonObject));var b="https://sdk.streamrail.com/player/sr.ads.js";smCallURL(b),SMreportEvent("CDN_CHECK","",10)}}function parseHftResponseEvent(e){var t="";try{t=e.responseStatus,printLogs("Got HFT event from server. Start parsing HFT response. Status="+t),"OK"==t?buildStreamRailSetupObject(e):(printErrors("Got error from HFT server. loading defaults"),SMreportEvent("LOGIC_ERROR","Failed to parse erver HFT response. Status="+t,100)),printLogs("Finished parse server HFT response. Status="+t)}catch(s){printErrors("Exception while parsing server HFT response. loading defaults. "+s),SMreportEvent("LOGIC_ERROR","Failed to parse erver HFT response. err="+s,100)}printLogs("Start init SR player immediately after getting response from server")}var smMainClientVersion="3.0.2.0",smMainScript="",smMacrosObject={declaredurl:"",placementId:"",campaignId:"1",price:"0",sellerId:"1",publisherId:"1",bidPrice:"0",ecp:"0",cacheBuster:"1",creativeId:"1",reservePrice:"0",isPreview:"0",server:"qa",cv:"",cb:""},sminternalconfig={logs:!1,maxParamSize:300,maxUrlSize:2e3},smoperational={validSession:!0,sessionBreakReason:"",clientVersion:smMainClientVersion,ssl:0,responseType:"",loopnumber:0,loop:0,lastEvent:"",startTime:(new Date).getTime(),adTagId:null,tagPriority:0,waterfallStr:"",hftResponseType:"",eventUrl:"",hftUrl:"",sessionId:"",visibilityState:"unknown",impressionPixel:"",clickPixel:"",completePixel:"",click:""},smcounters={breakIndex:0,lastTag:"",lastEventTS:(new Date).getTime(),eventsSentLog:"",flash:0,serveFlash:1,latencyLimit:12e4,listsize:7,sentImpDiscrepancy:0,sentSetupError:0},smMembers={smStringParams:"",docReferrer:"",topLocation:"",docWidth:0,smdocHeight:0,screen_availHeight:0,screen_height:0,screen_width:0,screen_availWidth:0,protocol:"http:"},smTagsObjects={},smSetupJsonObject={content:{},ads:{schedule:[]}},smWaterfallArr=[];window.srAsyncInit=function(){var e=null;try{e=SR("sm_player",smSetupJsonObject)}catch(t){SMreportEvent("SETUP_ERROR","!!! error setup SR player err="+t,100)}e&&(SMreportEvent("LOAD","",100),e.on("AdImpression",function(e){var t="";try{var s=e.analytics.adsourceid;smoperational.adTagId=s,smTagsObjects[s].imptime=(new Date).getTime(),smTagsObjects[s].impressions++,t="adURL="+e.assetURI}catch(r){t="failure at AdImpression "+r}SMreportEvent("IMPRESSION",t,100),0==smoperational.impressionPixel.indexOf("http")&&smCallURL(smoperational.impressionPixel)}),e.on("AdVideoComplete",function(e){message="";try{var t=e.analytics.adsourceid;smoperational.adTagId=t,smTagsObjects[t].completes++,message=smGetTagSummary(t)}catch(s){message="failure at AdVideoComplete "+s}SMreportEvent("COMPLETE",message,100),0==smoperational.completePixel.indexOf("http")&&smCallURL(smoperational.completePixel)}),e.on("AdClickThru",function(e){var t="";try{var s=e.analytics.adsourceid;smoperational.adTagId=s}catch(r){t="failure at click "+r}SMreportEvent("AD_CLICK",t,100),0==smoperational.clickPixel.indexOf("http")&&smCallURL(smoperational.clickPixel)}),e.on("AdVideoStart",function(e){var t="";try{var s=e.analytics.adsourceid;smoperational.adTagId=s}catch(r){t="failure at AD_PLAY "+r}SMreportEvent("AD_PLAY",t,10)}),e.on("AdVideoFirstQuartile",function(e){var t="";try{var s=e.analytics.adsourceid;smoperational.adTagId=s,smTagsObjects[s].verifys++}catch(r){t="failure at AD_PLAY "+r}SMreportEvent("AD_VERIFY",t,100)}),e.on("AdRequest",function(e){var t="";try{var s=e.adSource.id;smoperational.adTagId=s,smTagsObjects[s].starttime=(new Date).getTime(),smTagsObjects[s].requests++,1==smTagsObjects[s].order&&smcounters.breakIndex++,SMreportEvent("AD_REQUEST",t,10)}catch(r){t="failure at request "+r,SMreportEvent("LOGIC_ERROR",t,1)}}),e.on("AdError",function(e){var t="",s="";try{var r=e.analytics.adsourceid;smoperational.adTagId=r,smTagsObjects[r].errors++;try{s=e.error.message}catch(i){t="No Data "}}catch(i){s="failure at adError "+i}SMreportEvent("AD_ERROR",t+" "+s,10)}),e.on("error",function(e){var t="";try{t=JSON.stringify(e.error)}catch(s){t="error:"+s}0==smcounters.sentSetupError&&(SMreportEvent("PLAYER_ERROR",t,100),smcounters.sentSetupError++)}),e.on("playerError",function(e){var t="";try{t=JSON.stringify(e.error)}catch(s){t="error:"+s}smcounters.sentSetupError<2&&(SMreportEvent("PLAYER_ERROR",t,100),smcounters.sentSetupError++)}),e.on("contentEnd",function(e){smoperational.loopnumber++;var t=smGetSessionSummary();SMreportEvent("TEST_PUB","loop="+smoperational.loopnumber+" "+t,10)}))};try{printLogs("*** Start SelectMedia main script ***"),initMembers(),SMreportEvent("PRE_INIT","",100),getHftResponseFromServer(),printLogs("*** Finished SelectMedia main script ***")}catch(err){printErrors("Error while executing SelectMedia main script. "+err),SMreportEvent("LOGIC_ERROR","Error while executing SelectMedia main script. "+err,100)}